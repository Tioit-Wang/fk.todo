# 桌面级 Todo 工具需求文档（MVP）

## 1. 文档概述

### 1.1 文档目的

本文档明确桌面级 Todo 工具的功能需求、交互逻辑、数据存储规则及设计规范，为开发、测试及设计工作提供统一依据，确保产品符合“快速记录、精准提醒、科学规划”的核心诉求。

### 1.2 产品定位

一款轻量、高效、专注桌面场景的任务管理工具。通过快捷键唤醒、强制提醒、四象限分类、循环任务与筛选排序等能力，帮助用户梳理每日任务、把控优先级，提升时间管理效率。

### 1.3 核心优势

- 快捷唤醒：通过快捷键快速调出任务窗口，无需切换应用，即时记录任务。
- 强制提醒：以全屏宽度的置顶弹窗吸引注意力，确保重要任务不遗漏（受系统限制，详见 2.3.4）。
- 极简交互：核心操作一步直达，兼顾快速记录与必要配置（到期、循环、提醒、重要性）。
- 科学规划：主界面四象限分类，帮助用户明确任务优先级，聚焦核心工作。

## 2. 功能需求

### 2.1 快捷任务窗口（核心交互入口）

#### 2.1.1 唤醒与关闭

1. 唤醒方式：支持自定义快捷键（默认推荐 `Ctrl+Shift+T`，可在设置中修改）。按下快捷键后，在桌面居中偏下位置弹出快捷窗口。
2. 窗口层级：默认不置顶；快捷窗口右上角提供“置顶”按钮，开启后窗口保持置顶（always-on-top），再次点击取消。
3. 主界面与快捷窗口区分：
   - 主界面：独立完整窗口，支持四象限管理、列表视图切换及基础批量操作，适合任务规划。
   - 快捷窗口：轻量弹窗，聚焦“逾期 + 今天”任务快速查看、添加与简易操作，适配临时记录场景。
4. 关闭方式：支持点击窗口外空白区域、按下 `Esc` 键、点击窗口右上角关闭按钮关闭快捷窗口。
5. 窗口状态记忆：
   - 快捷窗口位置/大小：拖动窗口后，若 2 秒内无进一步拖动，自动保存当前位置与大小，下次唤醒恢复。
   - 视图状态：记忆上次的筛选 Tab（待完成/已完成/全部）与排序选项。

#### 2.1.2 任务列表展示

1. 默认展示：快捷窗口默认展示“待完成”列表，范围为：
   - 所有逾期未完成任务
   - 所有到期日期为“今天”的未完成任务
2. 默认排序（MVP 固定规则）：
   - 逾期未完成优先（到期时间越早越靠前）
   - 今天未完成按到期时间由近及远
   - 同到期时间下：重要任务优先
   - 再同则：按添加时间由早及晚
3. 切换查看：顶部提供切换按钮：`待完成 / 已完成 / 全部`。
4. 任务项信息：单条任务展示内容包括：
   - 任务名称
   - 到期时间（必显示）
   - 重要标识（五角星）
   - 循环标识
   - 提醒标识（普通/强制）
5. 任务操作：
   - 左侧复选框：勾选后标记为已完成，任务字体添加删除线。
   - 右侧操作：编辑、删除（hover 时显示）。删除需二次确认。
   - 展开/收起：任务右侧提供展开按钮（默认收起，hover 时显示），展开后展示步骤列表。
6. 逾期显示：逾期未完成任务使用红色字体标记（不额外弹窗）。

#### 2.1.3 任务添加与输入框配置

1. 基础添加：窗口底部输入框提示“输入任务内容，回车添加”。输入后按下 `Enter` 添加任务。
2. 到期时间（必填）：
   - 所有任务必须有到期时间。
   - 快捷创建默认到期时间为“最近一次 18:00（本地时间）”：
     - 若当前时间 `now <= 今天 18:00`，则默认到期时间为今天 18:00。
     - 若当前时间 `now > 今天 18:00`，则默认到期时间为明天 18:00。
   - 点击到期时间图标可修改到期时间：精确到分钟。
   - 仅选择日期未选择时间时，时间默认补齐为 18:00。
3. 输入框右侧功能图标（从左至右，共 4 个）：
   - 图标 1：到期时间选择。
     - 快捷选项：今天 18:00、明天 18:00、后天 18:00、本周日 18:00、自定义。
   - 图标 2：循环配置。
     - 仅支持：不循环、每日、每周、每月、每年。
     - 每日循环：区分“仅工作日（周一至周五）”“包含周末”。
     - 每周循环：可勾选重复星期几。
     - 每月循环：按日期重复（当月无该日期则取当月最后一天）。
     - 每年循环：按具体日期重复（不做闰年特殊适配）。
     - 生成规则详见 2.4。
   - 图标 3：提醒配置。
     - 支持：不提醒、普通提醒、强制提醒。
     - 普通提醒：默认提醒时间为到期时间前 10 分钟，可自定义；提醒方式为系统级通知（Windows 通知栏、macOS 通知中心），带声音提示（仅开/关）。
     - 普通提醒通知支持动作：稍后提醒（固定 5 分钟后）、完成。
     - 强制提醒：默认提醒时间为到期时间，可设置提前时间；提醒方式按 2.3 执行。
   - 图标 4：重要标识。
     - 五角星默认灰色，点击变为黄色，标记任务为重要。
4. 配置重置：添加任务后，输入框内容清空，循环/提醒/重要标识重置为默认；到期时间默认继续按“最近一次 18:00”规则生成。
5. 步骤关联规则：
   - 步骤为任务附属内容，不可独立存在；删除任务时同步删除步骤。
   - 任务完成时不强制同步步骤完成状态，步骤仅用于记录回溯。

### 2.2 主界面（四象限任务管理）

#### 2.2.1 界面布局

1. 打开方式：支持从快捷窗口进入，或双击桌面图标打开。
2. 窗口：独立窗口，支持最大化/最小化/拖拽调整大小，默认尺寸为 800×600。
3. 四象限划分：界面按“重要性-紧急性”分为四个象限。每个象限为独立模块，可折叠/展开，顶部显示象限名称与任务数量（已完成/总数）：
   - 第一象限：重要且紧急
   - 第二象限：重要不紧急
   - 第三象限：紧急不重要
   - 第四象限：不重要不紧急

#### 2.2.2 主界面功能

1. 任务管理：各象限任务列表支持添加、编辑、删除、标记完成；逻辑与快捷窗口一致。
2. 拖拽：支持拖拽任务在不同象限间移动，修改所属象限。
3. 步骤：每条任务支持展开/收起步骤列表；步骤仅支持添加、删除、单个勾选完成状态。
4. 备注：支持为每条任务添加备注（多行文本）。
5. 筛选与排序（必须）：
   - 筛选：到期范围（逾期/今天/明天/未来/全部）、重要性、循环状态、提醒状态。
   - 排序：到期时间、添加时间、手动排序。
6. 视图切换：支持“四象限视图”与“列表视图”切换。
   - 列表视图按时间维度展示：逾期、今天、明天、未来、已完成。
7. 批量操作：支持勾选多条任务，提供批量删除、批量标记完成。

### 2.3 强制提醒功能（核心优势）

#### 2.3.1 弹窗样式与位置

1. 样式：无边框矩形弹窗，背景色为高对比度纯色（默认深灰色，可在设置中选择预设纯色），文字为白色（固定）。
2. 尺寸：高度为屏幕高度的 20%，宽度为屏幕宽度的 100%。
3. 位置：屏幕垂直居中，水平全屏。
4. 任务栏/Dock：强制提醒窗口不显示在任务栏/任务切换列表中（skipTaskbar）。

#### 2.3.2 提醒内容与交互

1. 内容展示：弹窗显示任务名称、到期时间、重要标识（黄色五角星）；不显示备注。
2. 操作按钮：弹窗底部居中设置三个按钮：
   - 立即完成：标记任务为已完成并关闭弹窗；若为循环任务则按 2.4 生成下一期。
   - 稍后提醒：关闭弹窗，固定 5 分钟后再次触发强制提醒。
   - 关闭提醒：关闭弹窗，本次强制提醒结束；任务若未完成仍会在列表中标记逾期，但不再触发本次提醒。

#### 2.3.3 触发规则

1. 触发时机：按任务配置的强制提醒时间触发；未设置提前时间则在到期时间准时触发。
2. 多任务提醒：若同一时间有多个强制提醒任务，按“重要性优先、到期时间优先”顺序依次展示。
3. 休眠/锁屏：电脑休眠或锁屏时无法弹窗；唤醒/解锁后立即补触发。
4. 声音提示：强制提醒触发时伴随提示音（仅支持开启/关闭）。

#### 2.3.4 实现边界与降级策略（MVP）

1. 系统限制说明：现代 Windows/macOS 存在系统级安全限制，应用无法在所有场景下保证弹窗“绝对不可遮挡”（例如 Windows UAC 安全桌面、独占全屏应用、macOS 全屏 Space 等）。
2. 降级策略：若强制提醒窗口无法置前/被遮挡，仍需触发系统通知与提示音，并在用户回到桌面/解锁后补弹一次。

### 2.4 循环任务规则（完成驱动）

1. 循环类型：不循环、每日、每周、每月、每年。
2. 生成时机：循环任务仅在“当前任务被标记为完成”时生成下一期任务。
3. 逾期处理：循环任务逾期未完成，不生成下一期；任务保留并标记为逾期。
4. 下一期到期时间计算：基于“当前任务到期时间 + 循环规则”计算。
5. 修改与删除：修改循环任务规则会影响未来生成；删除则停止后续生成。

### 2.5 本地数据存储（不加密）

#### 2.5.1 存储方式与路径

1. 采用本地文件存储（离线可用）。
2. 存储路径使用系统应用数据目录（不固定 Documents，不支持自定义路径）。
3. 典型文件结构：
   - `data.json`：任务与步骤数据
   - `settings.json`：用户设置
   - `backups/`：备份目录

#### 2.5.2 存储内容

1. 任务数据：任务名称、到期时间、循环配置、提醒配置（普通/强制）、重要标识、完成状态、添加时间、修改时间、所属象限、备注、关联步骤列表。
2. 配置数据：快捷键、强制提醒弹窗预设纯色、提醒声音开关、窗口关闭行为等。

#### 2.5.3 数据可靠性与备份

1. 原子写入：写入数据文件时采用临时文件 + 重命名覆盖方式，避免崩溃导致 JSON 损坏。
2. 自动备份：支持设置自动备份周期（每日、每周、每月），保留最近 5 个备份版本。
3. 手动备份与恢复：提供手动备份按钮；支持从备份恢复数据，恢复前弹出二次确认提示“恢复将覆盖当前数据”。
4. 数据迁移：用户更换设备时，可复制备份文件至新设备，通过“恢复数据”迁移任务与配置。

### 2.6 辅助功能与设置

#### 2.6.1 通用设置

1. 快捷键设置：支持自定义快捷窗口唤醒快捷键；不做快捷键冲突检测（提示用户自行规避）。
2. 界面设置：支持浅色/深色两种主题；窗口透明度固定（浅色 85% / 深色 90%）。
3. 提醒设置：提示音仅支持开启/关闭。
4. 关闭行为设置：
   - 点击窗口关闭按钮：`隐藏到托盘（默认）` 或 `退出应用`。

#### 2.6.2 托盘

1. 常驻托盘：关闭主界面后应用后台运行（托盘常驻），不影响提醒触发。
2. 托盘图标：显示待完成任务数量（逾期未完成 + 今天未完成）。
3. 托盘菜单：提供“打开快捷窗口”“退出”。

#### 2.6.3 通知权限被拒绝处理

1. 若系统通知权限被拒绝或被关闭：在设置页提示原因，并提供引导用户前往系统设置开启的入口。
2. 若用户始终拒绝：普通提醒降级为应用内提示（不弹系统通知）；强制提醒仍按 2.3 尝试弹窗并播放提示音。

### 2.7 时间语义与调度（MVP）

1. 时间基准：所有到期时间与提醒时间按“本地时间”展示与计算。
2. 调度方式：后台定时扫描到期/提醒（轮询扫描 + 去重触发），确保：
   - 到点触发一次（避免重复弹窗/重复通知）。
   - 休眠/锁屏错过后，解锁/唤醒立即补触发。
3. 系统时间变化：用户手动修改系统时间可能导致提醒提前/延后；应用需通过“已触发标记”避免同一提醒重复触发。

## 3. 交互设计规则

### 3.1 反馈机制

1. 操作反馈：按钮点击、添加任务、删除任务、切换步骤状态等操作，提供轻微颜色变化与可选提示音。
2. 错误提示：当操作失败（如备份失败、数据写入失败）时，弹出错误提示弹窗，说明错误原因及建议解决方案。
3. 状态提示：保留任务完成、提醒触发的基础文字提示（停留 2 秒自动消失）。

### 3.2 窗口交互

1. 快捷窗口：支持拖拽窗口边缘调整大小（最小尺寸 300×200），拖拽标题栏移动位置，下次唤醒保留。
2. 主界面：支持最大化、最小化、还原；关闭主界面后默认后台运行（由关闭行为设置控制是否退出）。
3. 弹窗交互：除强制提醒弹窗外，其他弹窗均支持按 `Esc` 关闭；强制提醒仅支持点击按钮关闭。

## 4. 非功能需求

### 4.1 性能要求

1. 启动速度：启动时间 ≤ 3 秒；快捷窗口唤醒时间 ≤ 0.5 秒。
2. 资源占用：后台运行时 CPU 占用率 ≤ 5%，内存占用 ≤ 100MB。
3. 稳定性：连续运行 72 小时无崩溃、无明显内存泄漏；提醒触发稳定。

### 4.2 兼容性要求

- 支持 Windows 10 及以上版本、macOS 12 及以上版本。
- 适配不同屏幕分辨率（从 1366×768 至 4K），弹窗尺寸自动适配屏幕大小。

### 4.3 易用性要求

1. 学习成本低：核心功能操作步骤 ≤ 2 步。
2. 交互一致性：同类操作交互逻辑统一（如删除需二次确认）。
3. 可访问性：界面文字对比度满足无障碍要求；核心快捷键可自定义。

### 4.4 技术栈要求

1. 技术选型：前端采用 React；桌面层及后端核心采用 Rust + Tauri 2。
2. 技术适配：Tauri 2 需适配 Windows/macOS，确保窗口置顶、位置记忆、系统通知、托盘等能力一致性。

## 5. 风险与补充说明

### 5.1 潜在风险及应对

1. 快捷键冲突：不提供冲突检测，仅在设置界面提示用户自行规避。
2. 提醒不可绝对覆盖：受系统限制，强制提醒无法在所有场景保证不可遮挡，需降级策略（见 2.3.4）。
3. 数据丢失：通过原子写入与自动备份降低风险；不提供定期备份提醒。
